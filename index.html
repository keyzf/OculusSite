<!DOCTYPE html>
<html>
  <head>
    <title>Sender</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
      <a-camera id="camera"></a-camera>
    </a-scene>
    <script>
      const socket = new WebSocket('ws://192.168.1.100:1234');

      function updateHeadRotation(rotation) {
        const x = rotation.x.toFixed(2);
        const y = rotation.y.toFixed(2);
        const z = rotation.z.toFixed(2);
        socket.send(JSON.stringify({ x, y, z }));
      }

      window.addEventListener('load', async () => {
        // Initialize WebXR session
        const session = await navigator.xr.requestSession('immersive-vr');

        // Initialize camera and set it as the XR reference space
        const camera = document.getElementById('camera');
        session.updateRenderState({ baseLayer: new XRWebGLLayer(session, camera.renderer) });
        session.requestReferenceSpace('local-floor').then((refSpace) => {
          camera.setAttribute('position', '0 0 0');
          camera.setAttribute('rotation', '0 0 0');
          camera.setAttribute('xr-webgl', { poseRefSpaceType: 'local-floor' });
          camera.setAttribute('xr-spatial-tracking', { poseRefSpace: refSpace });
          camera.components['xr-spatial-tracking'].referenceSpace = refSpace;
        });

        // Send head rotation data over WebSocket on each frame
        function onXRFrame(time, frame) {
          const pose = frame.getViewerPose();
          if (pose) {
            const rotation = pose.transform.orientation;
            updateHeadRotation(rotation);
          }
          session.requestAnimationFrame(onXRFrame);
        }
        session.requestAnimationFrame(onXRFrame);
      });
    </script>
  </body>
</html>